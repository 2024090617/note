以下是 **`du` 命令的最佳实践指南**，帮助高效分析磁盘使用情况并定位空间占用问题：

---

### **一、核心使用场景**

1. **快速查看目录大小**
2. **定位大文件/目录**
3. **监控磁盘空间变化**
4. **清理冗余文件前的分析**

---

### **二、常用命令组合与技巧**

#### 1. **基础用法**

```bash
# 查看当前目录各子目录大小（默认显示为 KB）
du

# 汇总显示当前目录总大小（-s）并以人类可读格式（-h）输出
du -sh

# 查看指定目录大小（如 /var）
du -sh /var
```

#### 2. **深度限制与排序**

```bash
# 查看当前目录下1级子目录大小，按大小排序
du -h --max-depth=1 | sort -h

# 查看所有子目录（递归）并按大小倒序排列
du -h | sort -hr | less
```

#### 3. **排除特定文件/目录**

```bash
# 排除所有 .log 文件
du -h --exclude="*.log"

# 排除多个目录（如 node_modules 和 .cache）
du -h --exclude="node_modules" --exclude=".cache"
```

#### 4. **结合 find 定位大文件**

```bash
# 查找当前目录下大于 100MB 的文件（结合 -exec 执行操作）
find . -type f -size +100M -exec du -h {} +
```

#### 5. **显示修改时间（辅助清理）**

```bash
# 显示目录大小及最后修改时间（按时间排序）
du -h --time | sort -k2
```

#### 6. **跨文件系统统计（避免统计挂载点）**

```bash
# 仅统计当前文件系统（跳过挂载的磁盘/NFS）
du -h -x /
```

---

### **三、最佳实践建议**

1. **优先使用 `-h` 参数**

   - 人类可读格式（如 MB/GB）更直观。
2. **限制递归深度**

   - 使用 `--max-depth=N` 避免无意义遍历，快速定位问题层级。
3. **排序输出结果**

   - 结合 `sort -h`（支持人类可读数值排序）快速识别最大目录。
4. **排除干扰项**

   - 使用 `--exclude` 过滤缓存目录（如 `node_modules`、`.cache`）、日志文件等。
5. **处理权限问题**

   - 若遇到权限错误，可临时使用 `sudo`（谨慎操作）：
     ```bash
     sudo du -sh /var/log
     ```
6. **替代工具推荐**

   - 使用 `ncdu`（交互式磁盘分析工具）更直观：
     ```bash
     ncdu /path/to/dir
     ```

---

### **四、典型问题排查流程**

#### **场景：磁盘空间不足**

```bash
# 1. 查看根目录占用情况
sudo du -h --max-depth=1 / | sort -h

# 2. 发现 /var 占用过大，进一步分析
sudo du -h --max-depth=2 /var | sort -h

# 3. 定位到 /var/log 下的超大日志文件
sudo find /var/log -type f -size +100M -exec ls -lh {} \;

# 4. 清理或归档旧日志
```

---

### **五、注意事项**

- **谨慎删除文件**：清理前确认文件用途，避免误删关键数据。
- **网络/挂载目录**：跨网络或挂载点扫描可能较慢，使用 `-x` 跳过。
- **隐藏文件**：默认统计包含隐藏文件（如 `.git`），需手动排除。

---

通过以上实践，可快速定位磁盘空间瓶颈并高效管理存储资源。
